---
import Layout from '../layouts/Layout.astro';
import Infobox from '../components/Infobox.astro';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';

import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

// 1. JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦å–å¾—
const allJson = await Astro.glob('../assets/works/**/*.json');

// 2. ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã™ã¹ã¦å–å¾—ï¼ˆã“ã‚Œã§ç”»åƒã®å®Ÿä½“ã‚’ã¤ã‹ã¿ã¾ã™ï¼‰
const allImages = await Astro.glob('../assets/works/**/*.{jpg,jpeg,png,webp,JPG,JPEG,PNG,WEBP}');

// 3. JSONã‚’æ—¥ä»˜é †ã«ä¸¦ã³æ›¿ãˆ
const sortedJson = allJson
  .sort((a, b) => {
    const dateA = new Date(a.date.replaceAll('.', '-')).getTime();
    const dateB = new Date(b.date.replaceAll('.', '-')).getTime();
    return dateB - dateA;
  })
  .slice(0, 4);

// 4. JSONã«å¯¾å¿œã™ã‚‹ç”»åƒã‚’ç´ä»˜ã‘ã‚‹
const recentWorks = sortedJson.map((json) => {
  const slug = json.id; // ä¾‹: "IMG_1511"

  // allImagesã®ä¸­ã‹ã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«åãŒã“ã®slugã¨ä¸€è‡´ã™ã‚‹ç”»åƒã‚’æ¢ã™
  const imageFile = allImages.find((img) => {
    // ãƒ‘ã‚¹ã®ä¸­ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆIMG_1511ï¼‰ã ã‘ã‚’æŠœãå‡ºã—ã¦æ¯”è¼ƒ
    const filename = img.default.src.split('/').pop().split('.')[0];
    return filename.includes(slug);
  });

  return {
    slug: slug,
    // è¦‹ã¤ã‹ã£ãŸç”»åƒã®å®Ÿä½“ãƒ‘ã‚¹ã‚’å…¥ã‚Œã‚‹ï¼ˆè¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°ç©ºï¼‰
    src: imageFile ? imageFile.default.src : ''
  };
});
---

<!doctype html>
<html lang="ja">
	<head>
		<BaseHead title="LaTeX-Gallery" description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
      <Infobox 
        name="ãƒ†ãƒ†ãƒ•ã§LaTeX" 
        nameEn="LaTeX"
        image="/images/backgrounds/IMG_2402.jpeg"
        imageCaption='ã‚«ãƒ—ãƒ»ãƒ†ãƒ†ãƒ•ãŒLaTeXã‚’ç·¨é›†ã—ã¦ã„ã‚‹æ§˜å­'
        twitter='_TeLaX'
        latexnoyomi='ãƒ©ãƒ†ãƒƒã‚¯ã‚¹ã€ãƒ©ãƒ†ãƒ•ã€ãƒ©ãƒ†ãƒƒã‚¯ã€ãƒ©ãƒ¼ãƒ†ãƒƒã‚¯ã€ãƒ¬ã‚¤ãƒ†ãƒ•ã€ãƒ¬ã‚¤ãƒ†ãƒƒã‚¯ã€ãƒ¬ã‚¤ãƒ†ãƒƒã‚¯ã‚¹'
        likeAnimals='ã‚¦ã‚·ç§‘ğŸƒ æµ·ç£ğŸ¦­ é³¥é¡å…¨èˆ¬ğŸ¦†'
        mostLikeAnimal='ãƒ‹ãƒ›ãƒ³ã‚«ãƒ¢ã‚·ã‚«ğŸ'
        likeColors='#B53827'
        likePlant='Black Lotus'
        likeFood='ãã° æ±ç„¡ã—éºº ãƒ›ã‚¿ãƒ† æ—¥æœ¬é…’ğŸ¶ è¾›ã„ã‚‚ã®ğŸ”¥'
        kiraiFood='ç´è±† ã‚³ãƒ¼ãƒ’ãƒ¼ æœç‰©å…¨èˆ¬'
        workspace='iPad Pro 12.9(6th gen)ã¨Apple pencil'
        oekakiapp='Procreate'
      />

			<h2>LaTeX-Gallery</h2>
      <section style="margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;"></section>
			
      <p>
        <br/>
			  è‡ªç§°furryçµµæãã®LaTeXã§ã™ã€‚<br/>
			  ã‚¦ã‚·ç§‘å‹•ç‰©ã®é­…åŠ›ã‚’åºƒã‚ã‚‹ã¹ãæ´»å‹•ã—ã¦ã„ã¾ã™ã€‚<br/>
			  ã‚¦ã‚·ç§‘ä»¥å¤–ã®å‹•ç‰©ã‚‚å¤§ä½“å¥½ãã§ã™ã€‚<br/>
			  æœ€è¿‘ã¯ãƒã‚±ãƒ¢ãƒ³ã‚‚å¥½ãã§ã™ã€‚ï¼ˆç¯€æ“ãŒãªã„ï¼‰<br/>
			</p>

      <figure class="main-image">
        <img src="/images/backgrounds/IMG_2416.jpeg" alt="ã‚µã‚¶ãƒ³ã‚«">
        <figcaption>ã‚¸ãƒ£ãƒ¼ã‚¸ãƒ¼ç¨®ã®ã‚µã‚¶ãƒ³ã‚«</figcaption>
      </figure>
			
			<p>
				ä½œã£ãŸä½œå“ã‚„å¥½ããªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èªã£ãŸã‚Šã€è‰²ã‚“ãªæ´»å‹•ã—ã¦ã„ã‚‹äººã¨ã‚‚ã£ã¨äº¤æµã—ã¦ã¿ãŸã„ã¨æ€ã£ã¦ã“ã®ã‚µã‚¤ãƒˆã‚’ä½œã‚Šã¾ã—ãŸã€‚<br/>
				æ›´æ–°äºˆå®šã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã—ã¦ã€æã„ãŸã‚¤ãƒ©ã‚¹ãƒˆã®åˆ¶ä½œãƒ¡ãƒ¢çš„ãªè©±ã‚„ã€å¥½ããªãƒ¢ãƒã®è‡ªåˆ†èªã‚Šè¨˜äº‹ãªã©ã‚’äºˆå®šã—ã¦ã„ã¾ã™ã€‚<br/>
			</p>

      <section style="margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;">
        <section class="recent-works-section">
          <h3>Recent Works</h3>
          <div class="recent-grid">
  {recentWorks.map((work) => (
    <a href={`/works/${work.slug}`} class="hover-popup">
      {work.src && <img src={work.src} alt="æœ€æ–°ä½œ" />}
    </a>
  ))}
</div>


          <p class="view-more">
            <a href="/gallery" class="view-more-link">View More</a>
          </p>
        </section>
      </section>

			<section style="margin-top: 2rem; border-top: 1px solid #ccc; padding-top: 1rem;">
        <h3>Free Drawing Space ğŸ¨</h3>
        <p>ãªã‹ã‚ˆãä½¿ãŠã†ã­ï¼ï¼</p>
        
        <iframe 
          src="https://wbo.ophir.dev/boards/latexVStetefu" 
          style="width: 100%; height: 500px; border: 2px solid #eee; border-radius: 8px;"
          title="Drawing Board">
        </iframe>
        <p style="text-align: center; text-transform: lowercase; font-size: 0.75rem; color: #666;">
          ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å…±æœ‰ã•ã‚Œã¾ã™ï¼
        </p>
      </section>
		</main>

    <Footer />

    <style>
      .view-more-link {
          display: inline-block;
          text-decoration: none;
          color: #111;
          font-size: 0.8rem;
          font-weight: 700;
          letter-spacing: 0.15em;
          text-transform: uppercase;
          padding: 10px 0;
          border-bottom: 2px solid #111;
          transition: all 0.3s ease;
      }

      .view-more-link:hover {
          color: #888;
          border-bottom-color: #888;
          transform: translateY(-2px);
      }

      .recent-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin: 20px 0;
      }

      main {
          width: 100%;
          max-width: 1080px; 
          margin: 0 auto;
          padding: 2em 20px; 
          box-sizing: border-box;
          overflow: hidden; /* å­è¦ç´ ã®ã¯ã¿å‡ºã—ã‚’ç¢ºå®Ÿã«ã‚«ãƒƒãƒˆ */
      }

      @media (max-width: 720px) {
        .recent-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }
      }

      .recent-grid img {
        width: 100%;
        aspect-ratio: 1 / 1;
        object-fit: cover;
        object-position: center 20%;
        border: 1px solid #eee;
      }

      @media (min-width: 720px) {
        /* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®ã‚¯ãƒ©ã‚¹ã«ç¢ºå®Ÿã«å½“ã¦ã‚‹ãŸã‚ global ã¾ãŸã¯ .infobox ã‚’ç¢ºèª */
        .infobox {
          margin-left: 2rem;
          float: right;
        }
      }
    </style>
	</body>
</html>
